【応答生成プロトコル $\mathcal{P}_{response}$ 適用：初心者向け・厳密性維持・詳細な要件定義】

---

# 画像アップロード＆閲覧Webアプリ（AWS上構築）の要件定義

---

## 1. システム全体像

**目的**  
- ユーザーがWebブラウザから画像ファイルをアップロードし、アップロード済み画像を一覧・閲覧できるWebアプリケーションをAWS上に構築する。

**特徴**  
- インターネット経由でどこからでも利用可能
- 画像ファイルは安全に保存され、必要に応じて削除可能
- 最低限のセキュリティを確保しつつ、初心者でも構築・運用できる設計

---

## 2. 機能要件

### 2.1. ユーザー機能

1. **画像アップロード**
    - Webブラウザから画像ファイル（jpg, png, gif等）を選択し、サーバー経由でアップロードできる
    - 1回のアップロードにつき1ファイル（発展：複数ファイル対応も可）

2. **画像一覧表示**
    - アップロード済み画像のサムネイル一覧をWebページ上に表示
    - 各画像をクリックすると、元画像（大きいサイズ）を表示

3. **画像削除（任意/発展）**
    - 一覧から画像を選択し、削除できる（初期は省略可）

4. **エラーハンドリング**
    - 不正なファイル形式やサイズ超過時、適切なエラーメッセージを表示

### 2.2. 管理者機能（最低限）

- サービスの稼働状況を確認できる（AWS管理画面での監視を想定）
- 必要に応じて、S3バケットやEC2インスタンスの管理ができる

---

## 3. 非機能要件

### 3.1. パフォーマンス

- 1ユーザーあたり同時に5枚程度の画像閲覧・アップロードに耐える
- 画像1枚あたり最大5MB（初期値、後で調整可）

### 3.2. 可用性

- 24時間365日稼働（ただし個人利用レベルの可用性で可）
- 障害発生時は手動で復旧可能

### 3.3. セキュリティ

- アップロードできるファイル形式・サイズを制限
- 不正なアクセス（例：外部からの不正なAPI呼び出し）を防ぐ
- S3バケットはパブリックアクセス禁止、必要な場合のみ署名付きURL等で画像を公開
- EC2インスタンスへのSSH接続は限定されたIPアドレスのみ許可

### 3.4. コスト

- AWS無料枠内で運用開始できること（無料枠を超える場合は事前に警告）

### 3.5. 運用・保守

- サーバーの起動・停止、S3バケットの管理が容易
- 障害発生時の復旧手順が明確

---

## 4. システム構成要件

### 4.1. AWSリソース

1. **EC2インスタンス**
    - Webアプリケーション（フロントエンド＋バックエンド）をホスト
    - 無料枠対象のt2.microまたはt3.microを推奨
    - OSはAmazon Linux 2またはUbuntu
    - 必要なセキュリティグループ設定（HTTP/HTTPS, SSH）

2. **S3バケット**
    - 画像ファイルの保存先
    - パブリックアクセス禁止
    - バケットポリシーでEC2からのアクセスを許可

3. **VPC（仮想ネットワーク）**
    - デフォルトVPCまたは新規VPC
    - サブネット、ルートテーブル、インターネットゲートウェイ等の基本設定

4. **IAMロール・ポリシー**
    - EC2インスタンスにS3へのアクセス権限を付与
    - 必要最小限の権限（例：PutObject, GetObject, ListBucket）

5. **セキュリティグループ**
    - EC2：HTTP(80), HTTPS(443)、SSH(22)（SSHは自分のIPのみ許可）
    - S3：パブリックアクセス無効

6. **（発展）Route53/CloudFront**
    - 独自ドメイン名やCDNを利用する場合のみ

### 4.2. アプリケーション構成

1. **フロントエンド**
    - HTML/CSS/JavaScriptによるWebページ
    - 画像アップロードフォーム、一覧表示、画像表示機能

2. **バックエンド**
    - Python（Flask/FastAPI等）やNode.js（Express等）など軽量なWebフレームワーク
    - 画像アップロード処理（S3への保存）、一覧取得、画像取得API
    - ファイル形式・サイズのバリデーション

3. **（発展）ユーザー認証**
    - 初期は未実装、必要に応じてCognito等で追加

---

## 5. 詳細な処理フロー

### 5.1. 画像アップロード

1. ユーザーがWebページで画像ファイルを選択し、「アップロード」ボタンを押す
2. フロントエンドが画像ファイルをバックエンドAPIに送信
3. バックエンドがファイル形式・サイズを検証
4. 問題なければ、S3バケットに画像を保存
5. 保存結果をフロントエンドに返す（成功/失敗）

### 5.2. 画像一覧表示

1. フロントエンドがバックエンドAPIに「画像一覧取得」をリクエスト
2. バックエンドがS3バケット内の画像リストを取得
3. 画像のURL（署名付きURL等）をフロントエンドに返す
4. フロントエンドが画像サムネイルを一覧表示

### 5.3. 画像閲覧

1. サムネイルをクリックすると、元画像のURLで画像を表示

### 5.4. 画像削除（任意/発展）

1. ユーザーが削除ボタンを押す
2. バックエンドがS3から該当画像を削除
3. 結果をフロントエンドに返す

---

## 6. セキュリティ要件（詳細）

- S3バケットは「パブリックアクセス完全禁止」
- 画像の閲覧は「署名付きURL」または「バックエンド経由で取得」
- EC2インスタンスへのSSHは自分のIPアドレスのみ許可
- アップロード時にファイル形式・サイズを必ず検証
- バックエンドAPIはCSRF/XSS等の基本的な対策を実施
- AWS IAMロールは「最小権限の原則」に従う

---

## 7. 運用・監視要件

- EC2/S3の利用状況をAWSマネジメントコンソールで確認可能
- CloudWatchで最低限の監視（CPU使用率、ディスク容量、エラーログ等）
- 障害時はAWSコンソールから手動で復旧可能
- コストの上限設定・アラート（AWS Budgets等）

---

## 8. 拡張性・発展性

- ユーザー認証（Cognito等）の追加
- 複数ユーザー対応（ユーザーごとに画像を分ける）
- 画像の自動リサイズ・サムネイル生成（Lambda等）
- 独自ドメイン名・SSL対応（Route53/ACM）
- 画像配信の高速化（CloudFront）

---

## 9. 制約事項

- AWS無料枠内での運用を前提（EC2/S3の利用量・リージョン等に注意）
- 個人利用または小規模グループ利用を想定
- 法的・倫理的に問題のある画像のアップロードは禁止

---

## 10. その他

- 構築・運用手順は初心者でも理解できるようにドキュメント化
- サンプルコードや設定例を用意する
- トラブルシューティングガイドを整備

---

**この要件定義は、初心者がAWSの基本サービスをバランスよく体験しつつ、実用的なWebアプリを安全に構築・運用できることを目指して設計されています。さらに具体的な設計や実装手順が必要な場合は、続けてご指示ください。**